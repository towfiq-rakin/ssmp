{% extends "base.html" %}

{% block title %}Academics - ScholarMate{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1 class="page-title">Academic Analytics</h1>
    
    <!-- Summary Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">CGPA</div>
            <div class="stat-value">{{ "%.2f"|format(academic_record.cgpa) }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Current Semester</div>
            <div class="stat-value">{{ academic_record.current_semester }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Last Semester GPA</div>
            <div class="stat-value">{{ "%.2f"|format(last_semester_gpa) if last_semester_gpa else 'N/A' }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Highest GPA</div>
            <div class="stat-value">{{ "%.2f"|format(highest_gpa) }}</div>
        </div>
    </div>
    
    <!-- Charts Side by Side -->
    {% if plot_progression or plot_bar_chart %}
    <div class="charts-container">
        {% if plot_progression %}
        <div class="chart-card">
            <h2>GPA Progression Over Time</h2>
            <img src="data:image/png;base64,{{ plot_progression }}" alt="GPA Progression Chart" class="chart-image">
        </div>
        {% endif %}
        
        {% if plot_bar_chart %}
        <div class="chart-card">
            <h2>Semester-wise GPA Comparison</h2>
            <img src="data:image/png;base64,{{ plot_bar_chart }}" alt="GPA Comparison Bar Chart" class="chart-image">
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Statistics Overview -->
    <div class="student-info-card">
        <h2>Academic Statistics</h2>
        <div class="stats-details-grid">
            <div class="stat-detail-item">
                <span class="stat-detail-label">Highest GPA:</span>
                <span class="stat-detail-value">{{ "%.2f"|format(highest_gpa) }}</span>
            </div>
            <div class="stat-detail-item">
                <span class="stat-detail-label">Lowest GPA:</span>
                <span class="stat-detail-value">{{ "%.2f"|format(lowest_gpa) }}</span>
            </div>
            <div class="stat-detail-item">
                <span class="stat-detail-label">Average GPA:</span>
                <span class="stat-detail-value">{{ "%.2f"|format(avg_gpa) }}</span>
            </div>
            <div class="stat-detail-item">
                <span class="stat-detail-label">Semesters Completed:</span>
                <span class="stat-detail-value">{{ last_completed_semester }}</span>
            </div>
        </div>
    </div>
    
    <!-- Semester-wise Details -->
    <div class="student-info-card">
        <h2>Semester-wise Performance</h2>
        <div class="table-container">
            <table class="students-table">
                <thead>
                    <tr>
                        <th>Semester</th>
                        <th>GPA</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in semester_records %}
                    <tr>
                        <td>Semester {{ record.semester }}</td>
                        <td>{{ "%.2f"|format(record.gpa) }}</td>
                        <td>
                            <span class="status-badge status-{{ record.status|lower|replace(' ', '-') }}">
                                {{ record.status }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Financial Aid Summary -->
    <div class="student-info-card">
        <h2>Financial Aid Summary</h2>
        <div class="aid-summary-grid">
            <div class="aid-item">
                <div class="aid-type">Scholarships</div>
                <div class="aid-count">{{ scholarships|length }} awarded</div>
                <div class="aid-amount">৳{{ "{:,.2f}".format(total_scholarship_amount) }}</div>
            </div>
            <div class="aid-item">
                <div class="aid-type">Stipends</div>
                <div class="aid-count">{{ stipends|length }} awarded</div>
                <div class="aid-amount">৳{{ "{:,.2f}".format(total_stipend_amount) }}</div>
            </div>
            <div class="aid-item total">
                <div class="aid-type">Total Aid</div>
                <div class="aid-count">{{ (scholarships|length + stipends|length) }} total</div>
                <div class="aid-amount">৳{{ "{:,.2f}".format(total_scholarship_amount + total_stipend_amount) }}</div>
            </div>
        </div>
    </div>
    
    <!-- Scholarship History -->
    {% if scholarships %}
    <div class="student-info-card">
        <h2>Scholarship History</h2>
        <div class="table-container">
            <table class="students-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Semester</th>
                        <th>Amount</th>
                        <th>Awarded On</th>
                    </tr>
                </thead>
                <tbody>
                    {% for scholarship in scholarships %}
                    <tr>
                        <td>{{ scholarship.type }}</td>
                        <td>{{ scholarship.semester }}</td>
                        <td>৳{{ "{:,.2f}".format(scholarship.amount) }}</td>
                        <td>{{ scholarship.awarded_at.strftime('%Y-%m-%d') if scholarship.awarded_at else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- Stipend History -->
    {% if stipends %}
    <div class="student-info-card">
        <h2>Stipend History</h2>
        <div class="table-container">
            <table class="students-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Semester</th>
                        <th>Amount</th>
                        <th>Awarded On</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stipend in stipends %}
                    <tr>
                        <td>{{ stipend.type }}</td>
                        <td>{{ stipend.semester }}</td>
                        <td>৳{{ "{:,.2f}".format(stipend.amount) }}</td>
                        <td>{{ stipend.awarded_at.strftime('%Y-%m-%d') if stipend.awarded_at else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    color: #333;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    text-align: center;
    border: 1px solid #e0e0e0;
}

.stat-label {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 10px;
    font-weight: 500;
}

.stat-value {
    font-size: 2em;
    font-weight: bold;
    color: #2196f3;
}

.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.chart-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.chart-card h2 {
    margin-bottom: 15px;
    color: #333;
    font-size: 1.1em;
}

.chart-image {
    width: 100%;
    height: auto;
    border-radius: 5px;
}

.stats-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.stat-detail-item {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 5px;
}

.stat-detail-label {
    font-weight: bold;
    color: #555;
}

.stat-detail-value {
    color: #2196f3;
    font-size: 1.1em;
    font-weight: bold;
}

.status-badge {
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 0.85em;
    font-weight: bold;
}

.status-excellent {
    background-color: #4caf50;
    color: white;
}

.status-good {
    background-color: #2196f3;
    color: white;
}

.status-average {
    background-color: #ff9800;
    color: white;
}

.status-below-average {
    background-color: #f44336;
    color: white;
}

.aid-summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.aid-item {
    text-align: center;
    padding: 20px;
    background-color: #f5f5f5;
    border-radius: 8px;
}

.aid-item.total {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.aid-type {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 10px;
}

.aid-count {
    font-size: 0.9em;
    opacity: 0.8;
    margin-bottom: 5px;
}

.aid-amount {
    font-size: 1.5em;
    font-weight: bold;
    color: #2196f3;
}

.aid-item.total .aid-amount {
    color: white;
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .stats-details-grid {
        grid-template-columns: 1fr;
    }
    
    .charts-container {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

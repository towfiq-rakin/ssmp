{% extends "base.html" %}

{% block title %}Student Details - ScholarMate{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="back-nav">
        <a href="{{ url_for('main.admin_students') }}" class="btn btn-back">‚Üê Back to Students</a>
    </div>

    <h1 class="page-title">Student Details</h1>

    <div class="student-info-card">
        <h2>Personal Information</h2>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Student ID:</span>
                <span class="info-value">{{ student.student_id }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Registration No:</span>
                <span class="info-value">{{ student.reg_no }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Name:</span>
                <span class="info-value">{{ student.name }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Email:</span>
                <span class="info-value">{{ student.email }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Session:</span>
                <span class="info-value">{{ student.session }}</span>
            </div>
            {% if department %}
            <div class="info-item">
                <span class="info-label">Department:</span>
                <span class="info-value">{{ department.name }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Faculty:</span>
                <span class="info-value">{{ department.faculty }}</span>
            </div>
            {% endif %}
        </div>
    </div>
    
    {% if academic_record %}
    <div class="student-info-card">
        <h2>Academic Record</h2>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">CGPA:</span>
                <span class="info-value">{{ academic_record.cgpa }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Current GPA:</span>
                <span class="info-value">{{ academic_record.gpa }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Semester:</span>
                <span class="info-value">{{ academic_record.semester }}</span>
            </div>
        </div>
        
        <div class="update-section">
            <button class="btn btn-update-record" onclick="showUpdateForm()">Update Academic Record</button>
        </div>
        
        <div id="update-form" class="update-form" style="display: none;">
            <h3>Update Academic Record</h3>
            <form id="academic-update-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="cgpa">CGPA:</label>
                        <input type="number" id="cgpa" name="cgpa" 
                               min="0" max="4" step="0.01" 
                               value="{{ academic_record.cgpa }}" required>
                        <span class="help-text">Range: 0.00 - 4.00</span>
                    </div>
                    <div class="form-group">
                        <label for="gpa">Current GPA:</label>
                        <input type="number" id="gpa" name="gpa" 
                               min="0" max="4" step="0.01" 
                               value="{{ academic_record.gpa }}" required>
                        <span class="help-text">Range: 0.00 - 4.00</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="semester">Semester:</label>
                        <select id="semester" name="semester" required>
                            <option value="Semester 1" {% if academic_record.semester == 'Semester 1' %}selected{% endif %}>Semester 1</option>
                            <option value="Semester 2" {% if academic_record.semester == 'Semester 2' %}selected{% endif %}>Semester 2</option>
                            <option value="Semester 3" {% if academic_record.semester == 'Semester 3' %}selected{% endif %}>Semester 3</option>
                            <option value="Semester 4" {% if academic_record.semester == 'Semester 4' %}selected{% endif %}>Semester 4</option>
                            <option value="Semester 5" {% if academic_record.semester == 'Semester 5' %}selected{% endif %}>Semester 5</option>
                            <option value="Semester 6" {% if academic_record.semester == 'Semester 6' %}selected{% endif %}>Semester 6</option>
                            <option value="Semester 7" {% if academic_record.semester == 'Semester 7' %}selected{% endif %}>Semester 7</option>
                            <option value="Semester 8" {% if academic_record.semester == 'Semester 8' %}selected{% endif %}>Semester 8</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-save">Save Changes</button>
                    <button type="button" class="btn btn-cancel" onclick="hideUpdateForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    {% else %}
    <div class="student-info-card">
        <h2>Academic Record</h2>
        <p class="no-results">No academic record found for this student.</p>
    </div>
    {% endif %}
</div>

<script>
function showUpdateForm() {
    document.getElementById('update-form').style.display = 'block';
    document.querySelector('.btn-update-record').style.display = 'none';
}

function hideUpdateForm() {
    document.getElementById('update-form').style.display = 'none';
    document.querySelector('.btn-update-record').style.display = 'inline-block';
}

document.getElementById('academic-update-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const cgpa = parseFloat(document.getElementById('cgpa').value);
    const gpa = parseFloat(document.getElementById('gpa').value);
    const semester = document.getElementById('semester').value;
    
    // Validate CGPA and GPA
    if (cgpa < 0 || cgpa > 4) {
        alert('CGPA must be between 0.00 and 4.00');
        return;
    }
    
    if (gpa < 0 || gpa > 4) {
        alert('GPA must be between 0.00 and 4.00');
        return;
    }
    
    if (!confirm('Are you sure you want to update this academic record?')) {
        return;
    }
    
    // Send update request
    fetch('/admin/student/{{ student.student_id }}/academic-record/update', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            cgpa: cgpa,
            gpa: gpa,
            semester: semester
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            window.location.reload();
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while updating the academic record.');
    });
});
</script>

<style>
.update-section {
    margin-top: 20px;
    text-align: center;
}

.btn-update-record {
    background-color: #2196f3;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
}

.btn-update-record:hover {
    background-color: #1976d2;
}

.update-form {
    margin-top: 20px;
    padding: 20px;
    background-color: #f5f5f5;
    border-radius: 8px;
}

.update-form h3 {
    margin-bottom: 20px;
    color: #333;
}

.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.form-group {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.form-group label {
    font-weight: bold;
    margin-bottom: 5px;
    color: #555;
}

.form-group input,
.form-group select {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1em;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #2196f3;
}

.help-text {
    font-size: 0.85em;
    color: #666;
    margin-top: 5px;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.btn-save {
    background-color: #4caf50;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
}

.btn-save:hover {
    background-color: #45a049;
}

.btn-cancel {
    background-color: #f44336;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
}

.btn-cancel:hover {
    background-color: #da190b;
}
</style>
{% endblock %}
